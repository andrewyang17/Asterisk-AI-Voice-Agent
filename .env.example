# ═══════════════════════════════════════════════════════════════════════════
# Asterisk AI Voice Agent - Environment Configuration
# ═══════════════════════════════════════════════════════════════════════════
# Copy this file to .env and configure for your environment.
# The install.sh script will guide you through setting these values.

# ═══════════════════════════════════════════════════════════════════════════
# REQUIRED: Asterisk ARI Connection
# ═══════════════════════════════════════════════════════════════════════════

# ASTERISK_HOST: How ai-engine connects to Asterisk
# Examples:
#   127.0.0.1              - Same host (default)
#   192.168.1.100          - Remote server
#   asterisk.example.com   - Remote by hostname
#   asterisk-container     - Docker container on same network
ASTERISK_HOST=127.0.0.1

# ARI Credentials (create in FreePBX: Settings → Asterisk REST Interface Users)
# Note: Both ASTERISK_ARI_* and ARI_* prefixes are supported
ASTERISK_ARI_USERNAME=asterisk
ASTERISK_ARI_PASSWORD=asterisk

# ═══════════════════════════════════════════════════════════════════════════
# REQUIRED: AI Provider API Keys
# ═══════════════════════════════════════════════════════════════════════════
# Get keys at:
#   OpenAI: https://platform.openai.com/api-keys
#   Deepgram: https://console.deepgram.com/

OPENAI_API_KEY=
DEEPGRAM_API_KEY=

# ═══════════════════════════════════════════════════════════════════════════
# AI Assistant Configuration
# ═══════════════════════════════════════════════════════════════════════════

GREETING="Hello, how can I help you today?"
AI_ROLE="You are a concise and helpful voice assistant."

# ═══════════════════════════════════════════════════════════════════════════
# Logging Configuration
# ═══════════════════════════════════════════════════════════════════════════

# Engine logging
LOG_LEVEL=info               # debug|info|warning|error|critical
LOG_FORMAT=console           # console (default, colored) | json (for troubleshooting)
LOG_COLOR=1                  # console only: 1=colored, 0=plain
LOG_SHOW_TRACEBACKS=auto     # auto|always|never

# Streaming component logging (controls audio pipeline verbosity)
STREAMING_LOG_LEVEL=info     # debug|info|warning|error

# Optional file logging (Docker logs are usually sufficient)
# LOG_TO_FILE=0
# LOG_FILE_PATH=/mnt/asterisk_media/ai-engine.log

# ═══════════════════════════════════════════════════════════════════════════
# Audio Transport Configuration
# ═══════════════════════════════════════════════════════════════════════════

# Transport mode: audiosocket (TCP, recommended) | externalmedia (RTP/UDP)
AUDIO_TRANSPORT=audiosocket

# Playback mode: stream (low latency) | file (compatibility)
DOWNSTREAM_MODE=stream

# AudioSocket settings (when AUDIO_TRANSPORT=audiosocket)
AUDIOSOCKET_HOST=0.0.0.0
AUDIOSOCKET_PORT=8090
AUDIOSOCKET_FORMAT=ulaw      # ulaw | slin16

# ExternalMedia settings (when AUDIO_TRANSPORT=externalmedia)
# EXTERNAL_MEDIA_RTP_HOST=127.0.0.1  # Use 0.0.0.0 for remote + firewall

# ═══════════════════════════════════════════════════════════════════════════
# Local AI Server (Optional - for local_hybrid pipeline)
# ═══════════════════════════════════════════════════════════════════════════

LOCAL_WS_URL=ws://127.0.0.1:8765
LOCAL_WS_CONNECT_TIMEOUT=2.0
LOCAL_WS_RESPONSE_TIMEOUT=5.0
LOCAL_WS_CHUNK_MS=320

# Local model paths and performance tuning (install.sh auto-configures these)
# LOCAL_LLM_MODEL_PATH=/app/models/llm/phi-3-mini-4k-instruct.Q4_K_M.gguf
# LOCAL_STT_MODEL_PATH=/app/models/stt/vosk-model-en-us-0.22
# LOCAL_TTS_MODEL_PATH=/app/models/tts/en_US-lessac-medium.onnx
# LOCAL_LLM_THREADS=16
# LOCAL_LLM_CONTEXT=512
# LOCAL_LLM_BATCH=512
# LOCAL_LLM_MAX_TOKENS=32
# LOCAL_LLM_TEMPERATURE=0.3

# ═══════════════════════════════════════════════════════════════════════════
# OPTIONAL: Monitoring & Email Summaries
# ═══════════════════════════════════════════════════════════════════════════
# Get API key at https://resend.com
# Configure email settings in config/ai-agent.yaml under monitoring.email

# RESEND_API_KEY=

# ═══════════════════════════════════════════════════════════════════════════
# Health Endpoint (Optional - for external monitoring)
# ═══════════════════════════════════════════════════════════════════════════

# HEALTH_BIND_HOST=127.0.0.1  # Use 0.0.0.0 for remote monitoring
# HEALTH_BIND_PORT=15000

# ═══════════════════════════════════════════════════════════════════════════
# Advanced: Barge-in Tuning (Optional overrides)
# ═══════════════════════════════════════════════════════════════════════════
# Only modify if you need to tune interruption behavior

# BARGE_IN_ENABLED=true
# BARGE_IN_INITIAL_PROTECTION_MS=400
# BARGE_IN_MIN_MS=400
# BARGE_IN_ENERGY_THRESHOLD=1800
# BARGE_IN_COOLDOWN_MS=1000
# BARGE_IN_POST_TTS_END_PROTECTION_MS=250

# ═══════════════════════════════════════════════════════════════════════════
# DIAGNOSTIC: Audio Debugging (DO NOT enable in production)
# ═══════════════════════════════════════════════════════════════════════════
# These create WAV file taps for root cause analysis
# See docs/TROUBLESHOOTING.md for usage

DIAG_ENABLE_TAPS=false
# DIAG_TAP_PRE_SECS=1
# DIAG_TAP_POST_SECS=1
# DIAG_TAP_OUTPUT_DIR=/tmp/ai-engine-taps
# DIAG_EGRESS_SWAP_MODE=none       # auto|swap|none
# DIAG_EGRESS_FORCE_MULAW=false
# DIAG_ATTACK_MS=0
